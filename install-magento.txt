rm -rf /srv/site/*

# Borde funka utan dessa nu
# chown www-data:www-data site
# mkdir /var/www/.composer
# chown www-data /var/www/.composer

cd /srv/site
# First time composer must be running as root, otherwise we will get remove folder errors.
/usr/local/bin/composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition /srv/site
(Fill in marketplace credentials, create new keys!)

chown -R www-data:www-data /srv/site

magento setup:install \
--base-url=[https://[YOUR-SERVER-NAME] \
--db-host=db \
--db-name=sitedb \
--db-user=siteuser \
--db-password=sitepassword \
--admin-firstname=admin \
--admin-lastname=admin \
--admin-email=sven.wesley@gmail.com \
--admin-user=admin \
--admin-password=admin123 \
--language=sv_SE \
--currency=SEK \
--timezone=Europe/Stockholm \
--use-rewrites=1 \
--amqp-host="rabbitmq" \
--amqp-port="5672" \
--amqp-user="magentorabbit" \
--amqp-password="passiwortivettu" \
--amqp-virtualhost="/"

[SUCCESS]: Magento installation complete.
[SUCCESS]: Magento Admin URI: /admin_1rqmkw
Nothing to import.

find var generated vendor pub/static pub/media app/etc -type f -exec chmod g+w {} +
find var generated vendor pub/static pub/media app/etc -type d -exec chmod g+ws {} +
chown -R :www-data . # Ubuntu
chmod u+x bin/magento

KÖR REDEPLONG INIFRÅN CLI!!!
/usr/local/bin/magento-redeploy

magento config:set catalog/search/engine 'elasticsearch6'
magento config:set catalog/search/elasticsearch6_server_hostname 'elasticsearch-hostname.env'
magento config:set catalog/search/elasticsearch6_server_hostname 'elastic'
magento config:set catalog/search/elasticsearch6_server_port '9200'
magento config:set catalog/search/elasticsearch6_index_prefix 'magento2'
magento config:set catalog/search/elasticsearch6_enable_auth '0'
magento config:set catalog/search/elasticsearch6_server_timeout '15'
magento index:reindex